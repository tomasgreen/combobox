(function(){"use strict";function t(t,e){!t||0===t.length&&t!=window||(t.length?Array.prototype.forEach.call(t,function(t,i){e(t)}):e(t))}function e(t){return"string"==typeof t}function i(e,i,o,n){t(e,function(t){var e=i.split(" ");for(var l in e)t.addEventListener(e[l],o,n)})}function o(e,i){t(e,function(t){if(t.classList){var e=i.split(" ");for(var o in e)t.classList.add(e[o])}else t.className+=" "+i})}function n(e,i){t(e,function(t){if(t.classList){var e=i.split(" ");for(var o in e)t.classList.remove(e[o])}else t.className=t.className.replace(new RegExp("(^|\\b)"+i.split(" ").join("|")+"(\\b|$)","gi")," ")})}function l(t){return Array.prototype.slice.call(t,0)}function s(t,e){return t?t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className):void 0}function r(e,i){t(e,function(t){s(t,i)?n(t,i):o(t,i)})}function u(e,i,o){return void 0===o&&e&&void 0!==e.getAttribute?e.getAttribute(i):void t(e,function(t){t.setAttribute(i,o)})}function p(e,i){t(e,function(t){t.removeAttribute(i)})}function h(t){return t.replace(/(^\s+|\s+$)/g,"")}function c(t,e,i,o){var n,l;e||(e={}),-1!==t.indexOf(".")&&(l=t.split("."),t=l[0],l.shift(),e["class"]=l.join(" ")),-1!==t.indexOf("#")&&(l=t.split("#"),t=l[0],e.id=l[1]),n=document.createElement(t);for(var s in e)n.setAttribute(s,e[s]);return i&&i.appendChild(n),o&&(n.innerHTML=o),n}function d(t){void 0===t&&(t={});var e={};for(var i in m)e[i]=void 0!==t[i]?t[i]:m[i];return e}function a(t){r(t.previousSibling,"combobox-option-focused")}function f(t){r(t.nextSibling,"combobox-option-focused")}var v={leftArrow:37,rightArrow:39,enter:13,backspace:8,esc:27},b={willadd:"onWillAdd",willremove:"onWillRemove",willopen:"onWillOpen",willclose:"onWillClose",willload:"onWillLoad",didadd:"onDidAdd",didremove:"onDidRemove",didopen:"onDidOpen",didclose:"onDidClose",didload:"onDidLoad"},m={options:null,selected:null,delimiter:",",create:!0,createOnBlur:!0,openOnFocus:!0,maxSelected:0,closeAfterSelect:!0,selectOnTab:!0,onWillAdd:null,onWillRemove:null,onWillOpen:null,onWillClose:null,onWillLoad:null,onDidAdd:null,onDidRemove:null,onDidOpen:null,onDidClose:null,onDidLoad:null},y=function(o,n){this.opt=d(n),this.el=e(o)?document.querySelector(o):o,o&&(this.el.style.display="none",this.isSelectBox="select"==this.el.nodeName.toLowerCase(),this.container=c("div.combobox"),this.el.parentNode.insertBefore(this.container,this.el),this.container.appendChild(this.el),this.inputContainer=c("div.combobox-input-container",null,this.container),this.dropdown=c("div.combobox-dropdown",null,this.container),this.values=[],this.items=[],this.isSelectBox&&t(this.el.querySelectorAll("option"),function(t){this.items.push(t.textContent),null!==u(t,"selected")&&void 0!==u(t,"selected")&&(c("div.combobox-option",null,this.inputContainer,t.textContent),this.addValue(t.textContent))}.bind(this)),this.inputEl=c("input.combobox-input",null,this.inputContainer),this.tempEl=c("div.combobox-temp",null,this.container),this.tempEl.style.letterSpacing=this.inputEl.style.letterSpacing,this.tempEl.style.fontSize=this.inputEl.style.fontSize,this.tempEl.style.fontFamily=this.inputEl.style.fontFamily,this.tempEl.style.fontWeight=this.inputEl.style.fontWeight,this.tempEl.style.textTransform=this.inputEl.style.textTransform,i(this.inputContainer,"focus click",function(){this.focus()}.bind(this)),i(this.inputEl,"focus",function(){this.focus()}.bind(this)),i(this.inputEl,"blur",function(){this.blur()}.bind(this)),u(this.inputContainer,"placeholder",u(this.el,"placeholder")),i(this.inputEl,"input",this.updateInputSize.bind(this)),i(this.inputEl,"keydown",this.onKeyDown.bind(this)),this.togglePlaceholder())};y.prototype.onKeyDown=function(t){switch(t.keyCode){case v.rightArrow:this.onKeyRightArrow(t);break;case v.leftArrow:this.onKeyLeftArrow(t);break;case v.backspace:this.onKeyBackspace(t);break;case v.esc:this.onKeyEsc(t);break;case v.enter:this.onKeyEnter(t)}this.togglePlaceholder()},y.prototype.onKeyEsc=function(t){this.resetInput()},y.prototype.onKeyEnter=function(t){var e=this.inputEl.value=h(this.getValue());if(0!==e.length){var i=this.items.indexOf(e)>=0,o=this.values.indexOf(e)>=0;if(o)return void this.resetInput();if((i||this.opt.create)&&(!this.opt.onWillAdd||this.opt.onWillAdd(e)!==!1)){if(this.addValue(e),i&&this.items.push(e),this.isSelectBox){var n=this.findOption(e);n?(null===u(n,"selected")||void 0===u(n,"selected"))&&u(n,"selected",""):(n=c("option",null,this.el,e),u(n,"selected",""))}else this.el.value=this.values.join(this.opt.delimiter);var l=c("div.combobox-option",null,null,e);this.inputEl.parentNode.insertBefore(l,this.inputEl),this.resetInput(),this.inputEl.focus(),this.opt.onDidAdd&&this.opt.onDidAdd(e),this.populateDropdown()}}},y.prototype.onKeyBackspace=function(t){if(0===this.getValue().length){if(this.hasFocused())return void this.removeFocused();if(this.inputEl.previousSibling){var e=this.inputEl.previousSibling.textContent;this.opt.onWillRemove&&this.opt.onWillRemove(e)===!1||(this.isSelectBox&&p(this.findSelectedOption(this.inputEl.previousSibling.textContent),"selected"),this.removeValue(e),this.inputEl.parentNode.removeChild(this.inputEl.previousSibling),this.opt.onDidRemove&&this.opt.onDidRemove(e),this.inputEl.focus(),this.populateDropdown())}}},y.prototype.onKeyLeftArrow=function(t){0===this.getValue().length&&(t.shiftKey?a(this.inputEl):this.removeFocus(),this.inputEl.previousSibling&&this.inputEl.parentNode.insertBefore(this.inputEl,this.inputEl.previousSibling),this.inputEl.focus())},y.prototype.onKeyRightArrow=function(t){0===this.getValue().length&&(t.shiftKey?f(this.inputEl):this.removeFocus(),this.inputEl.nextSibling?this.inputEl.parentNode.insertBefore(this.inputEl,this.inputEl.nextSibling.nextSibling):this.inputEl.parentNode.appendChild(this.inputEl),this.inputEl.focus())},y.prototype.resetInput=function(){this.inputEl.value="",this.updateInputSize()},y.prototype.updateInputSize=function(){this.tempEl.innerHTML=this.getValue(),this.inputEl.style.width=this.tempEl.offsetWidth+4+"px",this.togglePlaceholder()},y.prototype.togglePlaceholder=function(){1===this.inputEl.parentNode.childNodes.length&&0===this.getValue().length?o(this.inputEl.parentNode,"combobox-placeholder"):n(this.inputEl.parentNode,"combobox-placeholder")},y.prototype.removeFocus=function(){n(this.inputEl.parentNode.querySelectorAll(".combobox-option-focused"),"combobox-option-focused")},y.prototype.hasFocused=function(){return this.inputEl.parentNode.querySelectorAll(".combobox-option-focused").length>0},y.prototype.removeFocused=function(){t(this.inputEl.parentNode.querySelectorAll(".combobox-option-focused"),function(t){this.removeValue(t.textContent),t.parentNode.removeChild(t)}.bind(this))},y.prototype.populateDropdown=function(){for(var t in this.items){var e=this.items[t],i=this.dropdown.querySelector('[data-value="'+e+'"]');-1==this.values.indexOf(e)?i||c("div.combobox-dropdown-option",{"data-value":e},this.dropdown,e):i&&this.dropdown.removeChild(i)}var o=l(this.dropdown.childNodes);if(!(o.length<2)){o.sort(function(t,e){return t.textContent.toLowerCase().localeCompare(e.textContent.toLowerCase())});for(var n=0;n<o.length;n++)o[n].parentNode.appendChild(o[n])}},y.prototype.removeValue=function(t){var e=this.values.indexOf(t);-1!=e&&this.values.splice(e,1)},y.prototype.addValue=function(t){this.values.push(t)},y.prototype.findSelectedOption=function(e){var i;return t(this.el.querySelectorAll("option[selected]"),function(t){t.textContent==e&&(i=t)}.bind(this)),i},y.prototype.findOption=function(e){var i;return t(this.el.querySelectorAll("option"),function(t){t.textContent==e&&(i=t)}.bind(this)),i},y.prototype.getValue=function(){return this.inputEl.value},y.prototype.focus=function(){this.inputEl.focus(),this.populateDropdown(),o(this.container,"combobox-dropdown-visible")},y.prototype.blur=function(){this.inputEl.blur(),this.populateDropdown(),n(this.container,"combobox-dropdown-visible")},y.prototype.getItems=function(){return this.items},y.prototype.getValues=function(){return 1===this.opt.maxSelected?this.values[0]:this.values},y.prototype.on=function(t,e){b[t]&&(this.opt[b[t]]=e)},this.ComboBox=function(t,e){var i=new y(t,e);return i},this.ComboBox.globals=m}).call(this);